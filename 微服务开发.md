# 获取登陆用户

~~~java
 @Autowired
 private HttpServletRequest request;
 SystemUserInfo user = SessionUtil.getSystemUserInfo(request);
~~~

# 入参判空：Optional

~~~java
        WorkloadResultDto dto = Optional.ofNullable(pageQueryParam.getParam()).orElseGet(WorkloadResultDto::new);
        SystemUserInfo user = SessionUtil.getSystemUserInfo(request);
~~~



        if (!user.getRoleIds().contains("admin")&&!user.getRoleIds().contains("gly")) {
            dto.setTeacherId(user.getUserId());
        }

3、注解事物回滚：【 @Transactional(rollbackFor = Exception.class)】
  声明式事务管理建立在AOP之上的。其本质是对方法前后进行拦截，然后在目标方法开始之前创建或者加入一个事务，在执行完目标方法之后根据执行情况提交或者回滚事务。

4、业务层异常抛出：【业务层异常类】
  if (CollectionUtils.isEmpty(studentIdList)) {
      throw new ServiceException(2, "请选中学生记录!");
  }

5、日志：log.info("====== 学生免实习申请审批成功 ======【{}:{}】", request.getRemoteAddr(), request.getRemotePort());


6、用户数据查看权限和用户角色数据审批权限
  <if test="funcSign != null and (funcSign.toString() == '1'.toString() or funcSign.toString() == '2'.toString()) ">
      <!--  用户数据查看权限(1：审批  2：查看) -->
      AND kc.KKXY IN(
      SELECT DISTINCT B.LSDW FROM XTGL_SJQX_YHZ@HXSJ B
      START WITH B.ID IN (SELECT A.ZID FROM XTGL_SJQX_ZCY@HXSJ A WHERE A.YHBH = #{userId,jdbcType=VARCHAR})
      CONNECT BY PRIOR B.ID = B.LSZID
      )
  </if>
  <if test="funcSign != null and funcSign.toString() == '1'.toString() ">
      <!--  用户角色数据审批权限(1：审批  2：查看),审批多加一层过滤 -->
      AND EXISTS(
      SELECT 1 FROM XTGL_SPLC_SPXXB@hxsj SPXXB
      JOIN LY_CKBZ_GXJC_JSYHGXB@hxsj JSYHGXB
      ON SPXXB.SPJSBH = JSYHGXB.JSBH
      WHERE SPXXB.CZBBH = 'T_SXJX_SXDG'
      AND SPXXB.BDZJID = dg.dgzj
      AND JSYHGXB.YHBH = #{userId,jdbcType=VARCHAR}
      )
  </if>

7、Lookback,去除模板代码
  @SneakyThrows

填充创建时间和创建人，修改时间修改人。
ObjectUtil.fillCreatorAndCreateTime(workloadStandardDto,request);
ObjectUtil.fillEditorAndEditTime(workloadStandardDto,request);

7、字体 仿宋_GB2312

=== 导出依赖 ===
【
        <!-- pdf工具库 -->
        <dependency>
            <groupId>com.itextpdf</groupId>
            <artifactId>itextpdf</artifactId>
            <version>5.5.13</version>
        </dependency>
        <!-- pdf辅助库 -->
        <dependency>
            <groupId>com.itextpdf</groupId>
            <artifactId>itext-asian</artifactId>
            <version>5.2.0</version>
        </dependency>

        <!-- itext add by linjitai on 20191028 -->
        <dependency>
            <groupId>com.lowagie</groupId>
            <artifactId>itext</artifactId>
            <version>2.1.7</version>
        </dependency>
        <dependency>
            <groupId>com.lowagie</groupId>
            <artifactId>itext-rtf</artifactId>
            <version>2.1.7</version>
        </dependency>
    
        <!-- poi，xwpf在该包下，引入这个会依赖引入 poi和poi-ooxml-schemas -->
        <!--        <dependency>-->
        <!--            <groupId>org.apache.poi</groupId>-->
        <!--            <artifactId>poi-ooxml</artifactId>-->
        <!--            <version>3.13</version>-->
        <!--        </dependency>-->
    
        <!-- CTPageSz  https://mvnrepository.com/artifact/org.apache.poi/ooxml-schemas -->
        <!-- pio -->
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>ooxml-schemas</artifactId>
            <version>1.1</version>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>3.8</version>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-scratchpad</artifactId>
            <version>3.8</version>
        </dependency>
】

--获取当前学年学期
(SELECT XNXQ_ID FROM gzjwxt_hxk.LY_CKBZ_GXJC_XNXQSZB WHERE SFDQXQ = '1') XNXQ,

数组拷贝
//将省份证号数组zjhArray拷贝到threeInfo数组中（从threeInfo的指定索引3开始拷贝，拷贝zjhArray数组所有元素）
System.arraycopy(zjhArray, 0, threeInfo, 3, zjhArray.length);
//数组填充
Arrays.fill(xhWidthArray, xhWidth);

 //身份证号宽度
 float[] zjhArrayArray = new float[zjhLength];
 float zjhWidth = 1107.0f / zjhLength;
 Arrays.fill(zjhArrayArray, zjhWidth);
 System.arraycopy(zjhArrayArray, 0, threeWidth, 2 + xhLength, zjhLength);
 PdfPTable threeTable = PdfUtil.fillTable(threeWidth, threeInfo, font);