
官网【http://zookeeper.apache.org/】

1、Zookeeper 的前世今生
  Apache ZooKeeper 是一个【高可靠的分布式协调中间件】。它是 Google Chubby 的一个开源实现，那么它主要是解决什么问题的呢？那就得先了解 Google Chubby是谷歌的一个用来解决分布式一致性问题的组件，同时，也是粗粒度的分布式锁服务，由于 Chubby 没有开源，所以雅虎公司基于 chubby 的思想，开发了一个类似的分布式协调组件 Zookeeper，后来捐赠给了 Apache。Chubby不开源，所以雅虎自己开发了。

2、分布式一致性问题
  什么是分布式一致性问题呢？简单来说，就是在一个分布式系统中，有多个节点，每个节点都会提出一个请求，但是在所有节点中只能确定一个请求被通过。而这个通过是需要所有节点达成一致的结果，所以所谓的一致性就是在提出的所有请求中能够选出最终一个确定请求。并且这个请求选出来以后，所有的节点都要知道。这个就是典型的拜占庭将军问题
  
3、分布式一致性的本质（拜占庭将军问题的本质）：
  由于网络通信存在不可靠的问题，可能存在消息丢失或网络延迟。如何在这样的背景下对某一个请求达成一致。为了解决这个问题，很多人提出了各种协议，比如大名鼎鼎的 Paxos，在不可信的网络环境中，按照 paxos协议就能够针对某个提议达成一致。所以：分布式一致性的本质，就是在分布式系统中，多个节点就某一个提议如何达成一致。
  
4、zookeeper的设计思想
  1)、防止单点故障（集群master/slave，leader/follower/observer(不参与投票)）
  2)、数据同步问题
  3)、leader选举算法（paxos-》zab协议）
  4)、2pc协议

5、数据模型
  zookeeper 的视图结构和标准的文件系统非常类似，每一个节点称之为 ZNode，是 zookeeper 的最小单元。每个 znode上都可以保存数据以及挂载子节点。构成一个层次化的树形结构

====== centos7中安装以及启动 zookeeper（前提是有jdk环境） ======

1、下载安装包【apache-zookeeper-3.6.0-bin.tar】

2、创建目录【mkdir zookeeper】，将安装包上传至服务器的zookeeper目录下，解压到文件夹【tar zxvf apache-zookeeper-3.6.0-bin.tar】

3、进入目录【cd /root/zookeeper/apache-zookeeper-3.6.0-bin/bin】，启动【sh zkServer.sh start】

4、命令行进入客户端【sh zkCli.sh】

5、命令行基本操作
  1)、创建节点【create /lock/ val】、【create /lock/tiger haha】
      有序节点【create -s /lock/ v】
	  临时节点【create -e /temp temp_tiger】,临时节点owner属性有值，相当于会话sessionID
	  临时有序【create -e -s /temp s_temp_tiger】,
  2)、删除节点【delete /node_name】
      递归删除【deleteall /lock】
  3)、设置数据【set /node_name】
  4)、获取数据【get /node_name】

6、节点特点
  1)、是一种树形结构：key=value 形式存储。
  2)、删除必须从最里层节点一层一层往外删(可以递归删除)。
  3)、同一层节点不能重复。
  4)、临时节点的生命周期和客户端的会话绑定在一起，当客户端会话失效该节点自动清理

7、对节点进行监听，事件只监听一次，开启两个回话，只会触发一次
  在其中一个会话中【get -w /haha】，另一个会话中【set haha tiger】
  【WATCHER::
   WatchedEvent state:SyncConnected type:NodeDataChanged path:/haha】

8、watch机制、临时节点、持久节点，实现注册服务
  
9、版本号
  1)、当前节点版本号：version，修改值一次，版本号加1。
  2)、子节点版本号：cversion，新建一个子节点，子节点版本号加1。













































