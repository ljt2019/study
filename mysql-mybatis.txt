
1、比较使用 EXISTS 和 IN 的查询。注意两个查询返回相同的结果。IN适合于外表大而内表小的情况；EXISTS适合于外表小而内表大的情况。
select * from TableIn where exists(select BID from TableEx where BNAME=TableIn.ANAME)
select * from TableIn where ANAME in(select BNAME from TableEx)
符合情况则返回true，不符合则返回false：SELECT exists(SELECT _view.id FROM mem_body_report_view _view WHERE _view.member_report_id = #{reportId} AND _view.delete_flag = 0)
		
		<select id="HavehealthRecordByReportTypeAndMemPrescriptionId" resultType="java.lang.Boolean">
			SELECT EXISTS(
				SELECT 
					1 
				FROM 
					mem_health_record _health_record 
				WHERE 
					_health_record.mem_prescription_id = #{memPrescriptionId} 
				AND 
					_health_record.record_type = #{recordType}
				)
		</select>

2、【sql中if函数的用法：IF(expr1,expr2,expr3)，其中，expr1是判断条件，expr2和expr3是符合expr1的自定义的返回结果。】
		if(_info.exam_num &gt; 0,'有','无') isTest,
   【三种选择条件以上】
	CASE WHEN _type.order_type_id = 'SALE' THEN '销售'  
	WHEN _type.order_type_id = 'PURCHASE' THEN '采购'
	ELSE '其他'	
	END AS orderType
			
3、

4、【sql中CONCAT函数的用法】
	CONCAT(_member.height,'cm') AS height,假如_member.height查询结果为 1.80，则height最终返回结果为字符串 1.80cm 
   
5、【mybatis中if标签的用法】
		<if test="inDTO.mallId !=null and inDTO.mallId !='' ">
			AND instr(_member.mall_id,#{inDTO.mallId}) > 0
	    </if>
		<if test="inDTO.bizName !=null and inDTO.bizName != ''">
			AND instr(_account_a_r.biz_name,#{inDTO.bizName}) > 0
		</if>    
		
		
6、模糊搜索【注意：数字和字符串连接应该用CONCAT()】
		<if test="param.deviceIdentity != null and param.deviceIdentity != '' ">
			AND device.device_identity LIKE CONCAT('%', #{param.deviceIdentity}, '%')
		</if>
		//全模糊查询,效率更高
		<if test="inDTO.mallId !=null and inDTO.mallId !='' ">
			AND instr(_member.mall_id,#{inDTO.mallId}) > 0
	    </if>
		
7、时间格式处理【yyyy-MM-dd HH:mm:ss】
	,DATE_FORMAT(record.create_time,'%Y-%m-%d %H:%i:%s') AS intoTime
	date_format(_record.start_time,'%Y-%m-%d %H:%i:%s') AS startTimeStr
	属性注解：@JsonFormat(pattern = "yyyy-MM-dd",timezone = "GMT+8") 【记得时区转换】
		
8、依据时间进行分组，并按时间进行降序排序【分组查询】
select t.* from
    (select r.mall_id
	,SUM(r.sport_metre) as sportMetre
	,SUM(r.sport_duration) as sportDuration
	,DATE_FORMAT(r.create_time,'%Y-%m-%d') as createDate 
    from mem_sport_record r where r.mall_id=#{mallId} and r.create_time>=#{startTime} and r.create_time<=#{endTime} GROUP BY createDate) t 
ORDER BY t.createDate asc;	

9、判空集合是否为空：【!param.statuses.isEmpty()】
	<if test="param.statuses != null and !param.statuses.isEmpty()">
         and da.status in
        <foreach item="item" index="index" collection="param.statuses" open="(" separator="," close=")">
          #{item}
        </foreach>
    </if>
	
10、【省市区关联】
		LEFT JOIN pub_region province ON province.id = xx.provinceId
		LEFT JOIN pub_region city ON city.id = xx .cityId
		LEFT JOIN pub_region region ON region.id = xx.regionId

11、返回集合list,list集合里边嵌套list集合
	//对应的OutDTO：GymDeviceOutDTO属性如下
	private String gymId;
	private String address;
	private String gymName;
	private String gymType;
	//......
	private List<GymDeviceDetailOutDTO> gymDeviceList = new ArrayList<GymDeviceDetailOutDTO>();

   1)、首先写一个 resultMap【返回list集合就需要写这个resultMap】
	<!-- 根据场馆查询场馆设备结果集 -->
	<resultMap id="GymRegionOutDTOMap" type="cn.healthmall.sail.base.dto.GymDeviceOutDTO"> 
		<id column="gymId" property="gymId"/>
		<result column="gymName" property="gymName"/>
		<result column="address" property="address"/>
		<result column="gymType" property="gymType"/>
		//......
		<collection property="gymDeviceList" javaType="ArrayList" 
			ofType="cn.healthmall.sail.base.dto.GymDeviceDetailOutDTO" column="id">
			<result column="id" property="id"/>
			<result column="deviceName" property="deviceName"/>
			<result column="devicePrice" property="devicePrice"/>
			<result column="deviceIdentity" property="deviceIdentity"/>
			<result column="productId" property="productId"/>
			<result column="deviceNo" property="deviceNo"/>
			<result column="productInfoId" property="productInfoId"/>
		</collection>
	</resultMap>
	
   2)、接着 
	<select id="queryGymDeriveList" resultMap="GymRegionOutDTOMap" parameterType="cn.healthmall.sail.base.dto.GymInDTO">
		SELECT temp.* from (
			SELECT 
				gym.id AS gymId 
				,gym.name as gymName
				,gym.address as address
				,CASE  
				WHEN gym.type = 0 then '小象运动'
				WHEN gym.type = 1 then '生活馆'
				END as gymType
				,dev.device_identity AS deviceIdentity
				,dev.device_no AS deviceNo
				,dev.product_info_id as productInfoId
				,dev.id as id
				,product.name as deviceName
				,product.id as productId
			FROM dev_gym gym
			LEFT JOIN dev_device dev ON dev.gym_id = gym.id AND dev.delete_flag = 0
			LEFT JOIN dev_product product ON dev.product_info_id = product.id
			LEFT JOIN dev_device_price gymPrice ON gymPrice.product_id = dev.product_info_id AND gymPrice.delete_flag = 0 
			AND gymPrice.device_scope_type = 3 AND gymPrice.device_scope = gym.id
			LEFT JOIN dev_device_price cityPrice ON cityPrice.product_id = dev.product_info_id AND cityPrice.delete_flag = 0 
			AND cityPrice.device_scope_type = 2 AND cityPrice.device_scope = gym.cityId
			LEFT JOIN dev_device_price allPrice ON allPrice.product_id = dev.product_info_id AND allPrice.delete_flag = 0 
			AND allPrice.device_scope_type = 1 AND allPrice.device_scope = '100000'
			WHERE gym.id = #{InDTO.id}
			AND gym.delete_flag = 0
			) temp
		ORDER BY temp.deviceNo
	</select>

12、返回txt文本信息【带With,在xml中】：List<Medal> selectByExampleWithBLOBs(MedalExample example);

13、【union all】的用法
	<select id="list" parameterType="java.lang.String" resultType="cn.healthmall.sail.member.dto.ArSportRecordOutDTO">
		SELECT a.* from (
			SELECT
				_record.id AS id,
				date_format(_record.start_time,'%Y-%m-%d %H:%i:%s') AS startTimeStr,
				_record.sport_duration AS sportDuration,
				_record.energy_consumption AS energyConsumption,
				_record.achievement AS achievement,
				_record.device_id AS deviceId,
				_record.course_id AS courseId,
				top.name AS courseName,
				top.image_url AS frontCoverUrl,
				_record.start_time AS startTime,
				_record.end_time AS endTime,
				_record.member_id AS memberId
				FROM mem_ar_record _record
				JOIN pre_top_motion top
				ON _record.course_id =top.id
				WHERE
				#{memberId}=_record.member_id
				AND _record.delete_flag=0
				AND top.delete_flag=0
		UNION ALL		
			SELECT
				_record.id AS id,
				date_format(_record.start_time,'%Y-%m-%d %H:%i:%s') AS startTimeStr,
				_record.sport_duration AS sportDuration,
				_record.energy_consumption AS energyConsumption,
				_record.achievement AS achievement,
				_record.device_id AS deviceId,
				_record.course_id AS courseId,
				_course.name AS courseName,
				_course.front_cover_url AS frontCoverUrl,
				_course.trainer AS  trainer,
				_record.start_time AS startTime,
				_record.end_time AS endTime,
				_record.member_id AS memberId
				FROM mem_ar_record _record
				JOIN base_ar_course _course
				ON _record.course_id =_course.id
				WHERE
				#{memberId}=_record.member_id
				AND _record.delete_flag=0
				AND _course.delete_flag=0
				) AS a
		ORDER BY a.startTime DESC
	</select>


	