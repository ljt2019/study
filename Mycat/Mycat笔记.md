# 学习目的

1. 掌握在数据库负载增大时的处理方法。

2. 理解 mycat 的基本概念。

3. 掌握mycat的基础配置和监控方法。

# 主要作用

1. 实现数据库的读写分离

2. 实现数据库的垂直拆分

3. 实现数据库的水平拆分

# 应用场景

1. 需要进行读写分离的场景

2. 需要进行分库分表的场景

3. 多租户场景

4. 数据统计

5. 需要使用同种方式查询多种数据库的场景

6. HBASE的一种替代方案

# 基本概念

1. 主机/实例
2. 物理数据库/物理表
3. 分片/分片节点
4. 分片键/分片算法
5. 逻辑数据库/逻辑表（Mycat）



# 分库分表

## 带来需要考虑的问题

1. 跨库关联查询

   解决方案：

   > 1. 字段冗余（反范式的设计）
   > 2. 

2. 分布式事务

3. 排序、分页、函数计算

4. 分布式全局ID

5. 数据同步

6. 事务（最终一致性）



# 多数据源

扩展 Spring 的 AbstractRoutingDataSource 抽象类，重写 determineCurrentLookupKey 方法动态数据源 determineCurrentLookupKey() 方法决定使用哪个数据源



# 数据库优化方案思路

1. 重启：释放资源的最好办法

2. SQL与索引：检查慢sql造成的原因，执行过程

3. 表与存储引擎

   如果 SQL 本身没有什么大问题，我们接着就要检查我们查询的目标，也就是表结构 的设计有没有问题。比如你对于字段类型和长度的选择，或者表结构是不是需要拆分或者合并，不同的表应该选择什么存储引擎，是不是要分区等等。

4. 架构

   表结构也没有问题了，就要上升到数据库服务的层面，从架构层面进行优化。 因为数据都是在磁盘上存储，如果加了索引还是很慢，干脆可以把数据在内存里面缓存起来，这个时候可以部署缓存服务器。查询数据先查缓存，没有再查数据库。这样 既可以减少数据库的压力，有可以提升查询速度。 如果一台数据库服务器承受不了访问压力，可以部署集群做负载均衡。当然这些数据库节点应该有自动同步的机制。 有了主从同步之后，就可以主从复制实现读写分离，让写的服务都访问 master 服务器，读的请求都访问从服务器。 有了读写分离之后，问题并没有完全解决： 1、只有一个 master，写的压力没有得到分摊； 2、所有的节点都存储相同的数据，在一个节点出现存储瓶颈的时候，磁盘不够用了， 其他的节点也一样会遇到这个问题。 所以这个时候我们要用到分布式环境中一个非常重要的手段：分片，每个节点都只存储总体数据的一部分，那这个就是我们今天要讲的分库分表。分片以后，为了提升可 用性，可以再对分片做冗余。

5. 数据库配置

   如果通过架构层面没有解决问题，或者机器虽然配置很高但是性能没有发挥到极致， 还可以优化数据库的配置，比如连接数，缓冲区大小等等。就像美颜相机一样，只是还原了你本来的美。

6. 操作系统

7. 当然咯，因为数据库是安装在操作系统上的，所以操作系统的配置也有优化的空间。 最后最后就是硬件的优化，在单机数据库上当然可以做。 这些所有的手段，成本越来越高，但是最后带来的单位收效却越来越小。 另外还有存储方案的替换，业务流程的优化，这里我们就不讨论了。

8. 

9. 。。。